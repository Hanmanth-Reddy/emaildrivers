#!/usr/bin/php

#############################################################################
## Sphinx.conf File Maker
## data source definition for dynamic
#############################################################################
#Start Candidates Index
<?php 
	include ("db_config.php");
	$dque="SELECT capp_info.comp_id FROM company_info LEFT JOIN capp_info ON capp_info.sno = company_info.sno LEFT JOIN options ON options.sno=company_info.sno WHERE options.sphinxdb='Y' AND company_info.status = 'ER' ORDER BY capp_info.comp_id";
	$dres=mysql_query($dque);
	while($drow=mysql_fetch_array($dres))
	{
		$companyuser=strtolower($drow[0]);
?>
source <?php echo $companyuser."_cand_main\n"; ?>
{
		type = xmlpipe2
		xmlpipe_command = php-cgi -f /usr/bin/db-driver/sphinx/candidates_docs.php mode=main companyuser=<?php echo $companyuser."\n";?>
}

source <?php echo $companyuser."_cand_delta:".$companyuser."_cand_main\n"; ?>
{
		type = xmlpipe2
		xmlpipe_command = php-cgi -f /usr/bin/db-driver/sphinx/candidates_docs.php mode=delta companyuser=<?php echo $companyuser."\n";?>
}

index <?php echo $companyuser."_cand_main\n"; ?> 
{
		source       = <?php echo $companyuser."_cand_main"."\n"; ?>
		path         = /sphinx-data/<?php echo cFolder($companyuser); ?>/<?php echo $companyuser."_cand_main\n"; ?>
		docinfo	= extern
		dict	= keywords
		mlock	= 0
		morphology = stem_en
		min_word_len = 1
		html_strip = 0		
		min_infix_len = 1
		index_exact_words	= 1
        
}

index <?php echo $companyuser."_cand_delta:".$companyuser."_cand_main\n"; ?>
{
		source                  = <?php echo $companyuser."_cand_delta"."\n"; ?>
		path                    = /sphinx-data/<?php echo cFolder($companyuser); ?>/<?php echo $companyuser."_cand_delta\n"; ?>
}

source <?php echo $companyuser."_cand_masters\n"; ?>
{
		type = xmlpipe2
		xmlpipe_command = php-cgi -f /usr/bin/db-driver/sphinx/candidates_masters.php companyuser=<?php echo $companyuser."\n";?>
}

index <?php echo $companyuser."_cand_masters\n"; ?>
{
		source                  = <?php echo $companyuser."_cand_masters"."\n";?>
		path                    = /sphinx-data/<?php echo cFolder($companyuser); ?>/<?php echo $companyuser."_cand_masters\n"; ?>
		docinfo	= extern
		dict	= keywords
		mlock	= 0
		morphology = stem_en
		min_word_len = 1
		html_strip = 0		
		min_infix_len = 1
		index_exact_words	= 1
}
#END Candidates Index

#Start Contacts Index
source <?php echo $companyuser."_cont_main\n"; ?>
{
		type = xmlpipe2
		xmlpipe_command = php-cgi -f /usr/bin/db-driver/sphinx/contacts_docs.php mode=main companyuser=<?php echo $companyuser."\n"; ?>
}

source <?php echo $companyuser."_cont_delta:".$companyuser."_cont_main\n"; ?>
{
		type = xmlpipe2
		xmlpipe_command = php-cgi -f /usr/bin/db-driver/sphinx/contacts_docs.php mode=delta companyuser=<?php echo $companyuser."\n"; ?>
}

index <?php echo $companyuser."_cont_main\n"; ?> 
{
		source       = <?php echo $companyuser."_cont_main"."\n"; ?>
		path         = /sphinx-data/<?php echo cFolder($companyuser); ?>/<?php echo $companyuser."_cont_main\n"; ?>
		docinfo	= extern
		dict	= keywords
		mlock	= 0
		morphology = stem_en
		min_word_len = 1
		html_strip = 0		
		min_infix_len = 1
		index_exact_words	= 1
}
index <?php echo $companyuser."_cont_delta:".$companyuser."_cont_main\n"; ?>
{
		source                  = <?php echo $companyuser."_cont_delta"."\n"; ?>
		path                    = /sphinx-data/<?php echo cFolder($companyuser); ?>/<?php echo $companyuser."_cont_delta\n"; ?>
}
#END Contacts Index

#Start Companies Index
source <?php echo $companyuser."_comp_main\n"; ?>
{
		type = xmlpipe2
		xmlpipe_command = php-cgi -f /usr/bin/db-driver/sphinx/companies_docs.php mode=main companyuser=<?php echo $companyuser."\n"; ?>
}

source <?php echo $companyuser."_comp_delta:".$companyuser."_comp_main\n"; ?>
{
		type = xmlpipe2
		xmlpipe_command = php-cgi -f /usr/bin/db-driver/sphinx/companies_docs.php mode=delta companyuser=<?php echo $companyuser."\n"; ?>
}

index <?php echo $companyuser."_comp_main\n"; ?> 
{
		source       = <?php echo $companyuser."_comp_main"."\n"; ?>
		path         = /sphinx-data/<?php echo cFolder($companyuser); ?>/<?php echo $companyuser."_comp_main\n"; ?>
		docinfo	= extern
		dict	= keywords
		mlock	= 0
		morphology = stem_en
		min_word_len = 1
		html_strip = 0		
		min_infix_len = 1
		index_exact_words	= 1
}
index <?php echo $companyuser."_comp_delta:".$companyuser."_comp_main\n"; ?>
{
		source                  = <?php echo $companyuser."_comp_delta"."\n"; ?>
		path                    = /sphinx-data/<?php echo cFolder($companyuser); ?>/<?php echo $companyuser."_comp_delta\n"; ?>
}
#END Companies Index

#JobOrders Index
source <?php echo $companyuser."_job_main\n"; ?>
{
		type = xmlpipe2
		xmlpipe_command = php-cgi -f /usr/bin/db-driver/sphinx/joborders_docs.php mode=main companyuser=<?php echo $companyuser."\n"; ?>
}

source <?php echo $companyuser."_job_delta:".$companyuser."_job_main\n"; ?>
{
		type = xmlpipe2
		xmlpipe_command = php-cgi -f /usr/bin/db-driver/sphinx/joborders_docs.php mode=delta companyuser=<?php echo $companyuser."\n"; ?>
}

index <?php echo $companyuser."_job_main\n"; ?> 
{
		source       = <?php echo $companyuser."_job_main"."\n"; ?>
		path         = /sphinx-data/<?php echo cFolder($companyuser); ?>/<?php echo $companyuser."_job_main\n"; ?>
		docinfo	= extern
		dict	= keywords
		mlock	= 0
		morphology = stem_en
		min_word_len = 1
		html_strip = 0		
		min_infix_len = 1
		index_exact_words	= 1
}
index <?php echo $companyuser."_job_delta:".$companyuser."_job_main\n"; ?>
{
		source                  = <?php echo $companyuser."_job_delta"."\n"; ?>
		path                    = /sphinx-data/<?php echo cFolder($companyuser); ?>/<?php echo $companyuser."_job_delta\n"; ?>
}

source <?php echo $companyuser."_job_masters\n"; ?>
{
		type = xmlpipe2
		xmlpipe_command = php-cgi -f /usr/bin/db-driver/sphinx/joborders_masters.php companyuser=<?php echo $companyuser."\n";?>
}

index <?php echo $companyuser."_job_masters\n"; ?>
{
		source                  = <?php echo $companyuser."_job_masters\n";?>
		path                    = /sphinx-data/<?php echo cFolder($companyuser); ?>/<?php echo $companyuser."_job_masters\n"; ?>
		docinfo	= extern
		dict	= keywords
		mlock	= 0
		morphology = stem_en
		min_word_len = 1
		html_strip = 0		
		min_infix_len = 1
		index_exact_words	= 1
}
#End JobOrders Index

index <?php echo $companyuser."_cont_list\n"; ?>
{
	type 	= distributed
	local	= <?php echo $companyuser."_cont_main\n"; ?>
	local	= <?php echo $companyuser."_cont_delta\n"; ?>
	#local	= <?php echo $companyuser."_cont_rtdata\n"; ?>
}

index <?php echo $companyuser."_comp_list\n"; ?>
{
	type 	= distributed
	local	= <?php echo $companyuser."_comp_main\n"; ?>
	local	= <?php echo $companyuser."_comp_delta\n"; ?>
	#local	= <?php echo $companyuser."_comp_rtdata\n"; ?>
}

index <?php echo $companyuser."_cand_list\n"; ?>
{
	type 	= distributed
	local	= <?php echo $companyuser."_cand_main\n"; ?>
	local	= <?php echo $companyuser."_cand_delta\n"; ?>
	#local	= <?php echo $companyuser."_cand_rtdata\n"; ?>
}

index <?php echo $companyuser."_job_list\n"; ?>
{
	type 	= distributed
	local	= <?php echo $companyuser."_job_main\n"; ?>
	local	= <?php echo $companyuser."_job_delta\n"; ?>
	#local	= <?php echo $companyuser."_job_rtdata\n"; ?>
}


<?php } ?>


indexer
{
		mem_limit               = 2047M
		max_xmlpipe2_field      = 25M
		write_buffer            = 16M
}

searchd
{
		listen			= <?php echo SPHINXAPIPORT."\n";?>
		listen			= <?php echo SPHINXPORT.":mysql41\n"; ?>
		log				= /var/log/sphinx/searchd.log
		query_log_format 	= sphinxql
		query_log		= /var/log/sphinx/query.log
		read_timeout	= 5
		max_children	= 30
		max_batch_queries = 256
		pid_file		= /var/run/sphinx/searchd.pid
		#max_matches		= 1000000
		seamless_rotate	= 1
		preopen_indexes	= 1
		unlink_old		= 1
		workers			= threads # for RT to work
		dist_threads = 24
		thread_stack	= 192k
		binlog_path		= /sphinx-data
}
